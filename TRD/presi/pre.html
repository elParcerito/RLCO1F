<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="pre.css">
  <title>Presidente del Curso</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    #observaciones { margin-top: 20px; }
    .obs { padding: 10px; border-bottom: 1px solid #ccc; }
  </style>

  <!-- SDKs de Firebase desde la nube -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

</head>
<body>
  <header>
    <h1>Presidente del Curso</h1>
  </header>

  <main>
    <div class="card">
      <h2>César Muñoz</h2>
      <p><strong>Rol:</strong> Presidente del curso</p>
      <p><strong>Responsabilidades:</strong></p>
      <ul>
        <li>Representar al curso en reuniones escolares.</li>
        <li>Coordinar actividades con los demás representantes.</li>
        <li>Velar por el bienestar del grupo.</li>
        <li>Servir de enlace entre curso y profesores.</li>
      </ul>

      <p class="quote">"Un buen líder no crea seguidores, crea más líderes."</p>
    </div>
    <div class="back-btn">
        <a href="../../bla.html">← Volver al inicio</a>
      </div>
  </main>
  <input type="text" id="remitente" placeholder="¿Quién eres? (Tu rol)">
  <textarea id="descripcion" placeholder="Escribe el contenido del aviso..." rows="4"></textarea>
  <input type="date" id="fechaEvento" placeholder="Fecha del evento">
  <button onclick="guardarAviso()">Enviar aviso</button>

  <div id="avisos">
    <h2>Lista de avisos</h2>
    <div id="listaAvisos"></div>
  </div>

  <script>
    // Configuración de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCHYo8LYSyOqgr6tBgo9RXODH0KRwZeowQ",
      authDomain: "live-de-eso.firebaseapp.com",
      projectId: "live-de-eso",
      storageBucket: "live-de-eso.firebasestorage.app",
      messagingSenderId: "250545251960",
      appId: "1:250545251960:web:94ad354f2650d46d32af8d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function escapeHTML(text) {
      const div = document.createElement("div");
      div.textContent = text;
      return div.innerHTML;
    }

    // Mostrar los avisos en tiempo real
    db.collection("avisos").orderBy("fechaSubida", "desc").onSnapshot((querySnapshot) => {
      const contenedor = document.getElementById("listaAvisos");
      contenedor.innerHTML = "";
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const fechaEvento = data.fechaEvento ? new Date(data.fechaEvento).toLocaleDateString() : "Sin fecha";
        const fechaSubida = data.fechaSubida?.toDate ? new Date(data.fechaSubida.toDate()).toLocaleString() : "Sin registro";

        contenedor.innerHTML += `
          <div class="aviso">
            <h3>${escapeHTML(fechaEvento)} — ${escapeHTML(data.descripcion)}</h3>
            <p><strong>Publicado por:</strong> ${escapeHTML(data.remitente)}</p>
            <small>Publicado el ${fechaSubida}</small>
          </div>
        `;
      });
    });

    // Guardar aviso
    function guardarAviso() {
      const remitente = document.getElementById("remitente").value.trim();
      const descripcion = document.getElementById("descripcion").value.trim();
      const fechaEvento = document.getElementById("fechaEvento").value;

      if (!remitente || !descripcion || !fechaEvento) {
        alert("Por favor completa todos los campos.");
        return;
      }

      db.collection("avisos").add({
        remitente,
        descripcion,
        fechaEvento: new Date(fechaEvento),
        fechaSubida: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        document.getElementById("remitente").value = "";
        document.getElementById("descripcion").value = "";
        document.getElementById("fechaEvento").value = "";
      });
    }
  </script>
</body>
</html>
